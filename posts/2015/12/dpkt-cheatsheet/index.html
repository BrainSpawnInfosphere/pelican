<!-- This is for the actual single article -->


<!DOCTYPE html>
<html lang="en">
<head>
  <title>dpkt Cheatsheet | Planet Express</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<meta name="description" content="How to use dpkt to mine packets on your netowrk for info"><meta name="author" content="walchko">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="../../../../theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link href="../../../../theme/css/pygments.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../../../../favicon.ico" type="image/x-icon">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="../../../..">Planet Express</a></div>
  <div class="small">Our crew is replaceable. Your package isn't.</div>
  <div class="nav">
  <li><a href="../../../../about.html">About Me</a></li>
  <li><a href="../../../../colophon.html">Colophon</a></li>
  <li><a href="../../../../categories.html">Topics</a></li>
  <li><a href="../../../../archives.html">Blog</a></li>
  </div>
  <div class="nav social">
<ul>
    <li><a href="http://github.com/walchko"><i class="fa fa-github-alt fa-2x"></i></a></li>
    <li><a href="http://stackoverflow.com/users/5374768/kevin"><i class="fa fa-stack-overflow fa-2x"></i></a></li>
    <li><a href="http://raspberrypi.stackexchange.com/users/1677/kevin"><i class="fa fa-stack-exchange fa-2x"></i></a></li>
</ul>  </div>
</div>    <div id="main">

<!--  -->

<h2><a href="../../../../posts/2015/12/dpkt-cheatsheet">dpkt Cheatsheet</a></h2>
<h5><i class="icon-feather"></i> Wed 30 December 2015
<i class="icon-bookmarks"></i>
</h5>

<p>dpkt is a python library for manipulating packets and although it is a good library it is
very poorly documented.</p>
<div class="figure align-center">
<img alt="" src="../../../../blog/cyber/pics/TCP-IP-model-vs-OSI-model.png" />
</div>
<div class="section" id="useful-ports">
<h2>Useful Ports</h2>
<div class="section" id="tcp">
<h3>TCP</h3>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">TCP Port</th>
<th class="head">Service</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>21</td>
<td>IRC</td>
</tr>
<tr><td>22</td>
<td>SSH</td>
</tr>
<tr><td>25</td>
<td>STMP</td>
</tr>
<tr><td>80</td>
<td>Http</td>
</tr>
<tr><td>123</td>
<td>Network Time Server</td>
</tr>
<tr><td>443</td>
<td>Https</td>
</tr>
<tr><td>445</td>
<td>SMB</td>
</tr>
<tr><td>548</td>
<td>Apple File Protocol (AFP) over TCP</td>
</tr>
<tr><td>3689</td>
<td>iTunes using the iTunes Library Sharing feature</td>
</tr>
<tr><td>5009</td>
<td>Airport admin utility</td>
</tr>
<tr><td>9100</td>
<td>HP Jet Direct</td>
</tr>
<tr><td>10000</td>
<td>??</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="udp">
<h3>UDP</h3>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">UDP Port</th>
<th class="head">Service</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>67,68</td>
<td>DHCP</td>
</tr>
<tr><td>123</td>
<td>NTP</td>
</tr>
<tr><td>5353</td>
<td>mDNS, Bonjour</td>
</tr>
<tr><td>17500</td>
<td>Dropbox</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="packet-types">
<h2>Packet Types</h2>
<p>There are many types of packets supported and several ways to test what they are:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">packet</span><span class="p">,</span><span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_IP</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_IP</span>
<span class="k">if</span> <span class="n">packet</span><span class="o">.</span><span class="n">p</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_IP</span>
</pre></div>
<p>dpkt.tcp.*  dpkt.udp.*  dpkt.icmp.*</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="16%" />
<col width="32%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">dpkt.ethernet.*</th>
<th class="head">Val</th>
<th class="head">dpkt.ip.*</th>
<th class="head">Val</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>ETH_TYPE_ARP</td>
<td>&nbsp;</td>
<td>IP_PROTO_ICMP</td>
<td>1</td>
</tr>
<tr><td>ETH_TYPE_IP</td>
<td>2048</td>
<td>IP_PROTO_TCP</td>
<td>6</td>
</tr>
<tr><td>ETH_TYPE_IP6</td>
<td>34525</td>
<td>IP_PROTO_UDP
ICMP6
SCTP</td>
<td>17
58
132</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ethernet-physical-datalink-layers">
<h2>Ethernet (Physical &amp; Datalink Layers)</h2>
<p>Ethernet is a family of computer networking technologies for local area
networks (LANs).</p>
<div class="highlight"><pre><span></span><span class="n">ether</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">Ethernet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">mac</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
<pre class="literal-block">
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Ethernet destination address (first 32 bits)            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Ethernet dest (last 16 bits)  |Ethernet source (first 16 bits)|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Ethernet source address (last 32 bits)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        Type code              |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Addresses</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>224.0.0.251</td>
<td><a class="reference external" href="http://en.wikipedia.org/wiki/Multicast_address">Multicast DNS</a> (mDNS)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ip-internet-protocol">
<h2>IP (Internet Protocol)</h2>
<p>The Internet Protocol (IP) is the principal communications protocol in the Internet
protocol suite for relaying datagrams across network boundaries. Its routing function
enables internetworking, and essentially establishes the Internet.</p>
<div class="highlight"><pre><span></span><span class="n">ip</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">IP</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">ip</span> <span class="o">=</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span>
<span class="n">ip_addr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">src</span><span class="o">|</span><span class="n">ip</span><span class="o">.</span><span class="n">dst</span><span class="p">)</span>
</pre></div>
<pre class="literal-block">
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |         Header Checksum       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<div class="section" id="ipv6">
<h2>IPv6</h2>
<pre class="literal-block">
$ host -t AAAA www.cyberciti.biz
www.cyberciti.biz has IPv6 address 2607:f0d0:1002:51::4

$ ping6 2607:f0d0:1002:51::4
PING 2607:f0d0:1002:51::4(2607:f0d0:1002:51::4) 56 data bytes
64 bytes from 2607:f0d0:1002:51::4: icmp_seq=1 ttl=64 time=0.056 ms
64 bytes from 2607:f0d0:1002:51::4: icmp_seq=2 ttl=64 time=0.027 ms
64 bytes from 2607:f0d0:1002:51::4: icmp_seq=3 ttl=64 time=0.021 ms
64 bytes from 2607:f0d0:1002:51::4: icmp_seq=4 ttl=64 time=0.023 ms
</pre>
<p>dpkt.ip6.IP6</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IP6</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">Packet</span><span class="p">):</span>
        <span class="n">__hdr__</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;_v_fc_flow&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mh">0x60000000</span><span class="n">L</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;plen&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># payload length (not including header)</span>
                <span class="p">(</span><span class="s1">&#39;nxt&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># next header protocol</span>
                <span class="p">(</span><span class="s1">&#39;hlim&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># hop limit</span>
                <span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;16s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;dst&#39;</span><span class="p">,</span> <span class="s1">&#39;16s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="p">)</span>
</pre></div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">nxt:</th><td class="field-body">Next header type, typical values are 6 for TCP, 17 for UDP, 58 for ICMPv6, 132 for SCTP.</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="n">socket</span><span class="o">.</span><span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="n">ip</span><span class="o">.</span><span class="n">dst</span><span class="p">)</span>
<span class="n">socket</span><span class="o">.</span><span class="n">inet_pton</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="s2">&quot;2001:1938:26f:1:204:4bff:0:1&quot;</span><span class="p">)</span>

<span class="n">ip</span> <span class="o">=</span> <span class="n">eth</span><span class="o">.</span><span class="n">data</span>
<span class="k">if</span> <span class="n">eth</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_IP6</span> <span class="ow">and</span> <span class="n">ip</span><span class="o">.</span><span class="n">nxt</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">IP_PROTO_UDP</span><span class="p">:</span>
</pre></div>
</div>
<div class="section" id="udp-user-datagram-protocol">
<h2>UDP (User Datagram Protocol)</h2>
<p>UDP uses a simple connectionless transmission model with a minimum of protocol mechanism.
It has no handshaking dialogues, and thus exposes any unreliability of the underlying
network protocol to the user's program. There is no guarantee of delivery, ordering, or
duplicate protection. UDP provides checksums for data integrity, and port numbers for
addressing different functions at the source and destination of the datagram.</p>
<pre class="literal-block">
0        7 8     15 16    23 24    31
 +--------+--------+--------+--------+
 |     Source      |   Destination   |
 |      Port       |      Port       |
 +--------+--------+--------+--------+
 |                 |                 |
 |     Length      |    Checksum     |
 +--------+--------+--------+--------+
 |
 |          data octets ...
 +---------------- ...
</pre>
</div>
<div class="section" id="tcp-transmission-control-protocol">
<h2>TCP (Transmission Control Protocol)</h2>
<p>The Transmission Control Protocol (TCP) is a core protocol of the Internet Protocol Suite.
TCP provides reliable, ordered, and error-checked delivery of a stream of octets between
applications running on hosts communicating over an IP network.</p>
<div class="highlight"><pre><span></span><span class="n">tcp</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">data</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">tcp</span><span class="o">.</span><span class="n">sport</span><span class="o">|</span><span class="n">dport</span>
</pre></div>
<pre class="literal-block">
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |       Destination Port        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Acknowledgment Number                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Data |           |U|A|P|R|S|F|                               |
| Offset| Reserved  |R|C|S|S|Y|I|            Window             |
|       |           |G|K|H|T|N|N|                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Checksum            |         Urgent Pointer        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             data                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<div class="section" id="tcp-flags">
<h3>TCP Flags</h3>
<div class="highlight"><pre><span></span><span class="n">fin_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_FIN</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">syn_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_SYN</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">rst_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_RST</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">psh_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_PUSH</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">ack_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_ACK</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">urg_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_URG</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">ece_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_ECE</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="n">cwr_flag</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tcp</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_CWR</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="dns-domain-name-system">
<h2>DNS (Domain Name System)</h2>
<p>The Domain Name System (DNS) is a hierarchical distributed naming system for computers,
services, or any resource connected to the Internet or a private network. An often-used
analogy to explain the Domain Name System is that it serves as the phone book for the
Internet by translating human-friendly computer hostnames into IP addresses. For example,
the domain name www.example.com translates to the addresses 93.184.216.119 (IPv4) and
2606:2800:220:6d:26bf:1447:1097:aa7 (IPv6).</p>
<p>A simple example of parsing a DNS packet</p>
<div class="highlight"><pre><span></span><span class="n">eth</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">Ethernet</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="n">ip</span> <span class="o">=</span> <span class="n">eth</span><span class="o">.</span><span class="n">data</span>
<span class="n">udp</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># make the dns object out of the udp data and check for it being a RR (answer)</span>
<span class="c1"># and for opcode QUERY (I know, counter-intuitive)</span>
<span class="k">if</span> <span class="n">udp</span><span class="o">.</span><span class="n">dport</span> <span class="o">!=</span> <span class="mi">53</span> <span class="ow">and</span> <span class="n">udp</span><span class="o">.</span><span class="n">sport</span> <span class="o">!=</span> <span class="mi">53</span><span class="p">:</span> <span class="k">continue</span>
<span class="n">dns</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="p">(</span><span class="n">udp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="k">if</span> <span class="n">dns</span><span class="o">.</span><span class="n">qr</span> <span class="o">!=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_R</span><span class="p">:</span> <span class="k">continue</span>
<span class="k">if</span> <span class="n">dns</span><span class="o">.</span><span class="n">opcode</span> <span class="o">!=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_QUERY</span><span class="p">:</span> <span class="k">continue</span>
<span class="k">if</span> <span class="n">dns</span><span class="o">.</span><span class="n">rcode</span> <span class="o">!=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_RCODE_NOERR</span><span class="p">:</span> <span class="k">continue</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dns</span><span class="o">.</span><span class="n">an</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
<span class="c1"># now we&#39;re going to process and spit out responses based on record type</span>
<span class="c1"># ref: http://en.wikipedia.org/wiki/List_of_DNS_record_types</span>
<span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">dns</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">answer</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_CNAME</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;CNAME request&quot;</span><span class="p">,</span> <span class="n">answer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">response&quot;</span><span class="p">,</span> <span class="n">answer</span><span class="o">.</span><span class="n">cname</span>
        <span class="k">elif</span> <span class="n">answer</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_A</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;A request&quot;</span><span class="p">,</span> <span class="n">answer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">response&quot;</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">rdata</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">answer</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_PTR</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;PTR request&quot;</span><span class="p">,</span> <span class="n">answer</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">response&quot;</span><span class="p">,</span> <span class="n">answer</span><span class="o">.</span><span class="n">ptrname</span>
</pre></div>
<p>Make a DNS packet</p>
<div class="highlight"><pre><span></span><span class="n">dns</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="p">(</span><span class="n">udp</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">dns</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_RA</span>
<span class="n">dns</span><span class="o">.</span><span class="n">rcode</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_RCODE_NOERR</span>
<span class="n">dns</span><span class="o">.</span><span class="n">qr</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_R</span>

<span class="c1"># make a record</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="o">.</span><span class="n">RR</span><span class="p">()</span>
<span class="n">arr</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_IN</span>
<span class="n">arr</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_A</span>
<span class="n">arr</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;paypal.com&#39;</span>
<span class="n">arr</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">dnet</span><span class="o">.</span><span class="n">addr</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ip</span>

<span class="n">dns</span><span class="o">.</span><span class="n">an</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="k">print</span> <span class="n">dns</span>
<span class="o">&gt;&gt;</span> <span class="n">DNS</span><span class="p">(</span><span class="n">an</span><span class="o">=</span><span class="p">[</span><span class="n">RR</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;paypal.com&#39;</span><span class="p">)],</span> <span class="n">qd</span><span class="o">=</span><span class="p">[</span><span class="n">Q</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;paypal.com&#39;</span><span class="p">)],</span> <span class="nb">id</span><span class="o">=</span><span class="mi">21825</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="mi">32896</span><span class="p">)</span>
</pre></div>
<div class="section" id="dns-arrays">
<h3>DNS Arrays</h3>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">dpkt.dns.* arrays</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>qd(name='',type='')</td>
<td>Question</td>
</tr>
<tr><td>qd.name</td>
<td>The name that was searched, such as 'www.google.com'</td>
</tr>
<tr><td>qd.cls</td>
<td>class, dpkt.dns.DNS_IN</td>
</tr>
<tr><td>qd.type</td>
<td>dpkt.dns.DNS_A, many more options</td>
</tr>
<tr><td>an(name='',type='')</td>
<td>Answer</td>
</tr>
<tr><td>ns</td>
<td>List of name servers for this domain. You can iterate over the list</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dns-codes">
<h3>DNS Codes</h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">qr:</th><td class="field-body">Type of message, either query or response, hence Q/R: dpkt.dns.DNS_Q (0), dpkt.dns.DNS_R (1)</td>
</tr>
<tr class="field"><th class="field-name">opcode:</th><td class="field-body">What type of query, usually standard query: dpkt.dns.DNS_QUERY (0)</td>
</tr>
<tr class="field"><th class="field-name">rcode:</th><td class="field-body">Errors: dpkt.dns.DNS_RCODE_NOERR (0), anything else is an error</td>
</tr>
<tr class="field"><th class="field-name">op:</th><td class="field-body">No clue what this is: dpkt.dns.DNS_RA, dpkt.dns.DNS_AA</td>
</tr>
<tr class="field"><th class="field-name">ar:</th><td class="field-body">Authority record or additional record</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dns-questions">
<h3>DNS Questions</h3>
<p>dpkt.dns.DNS.Q(data)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">name:</th><td class="field-body">Domain name</td>
</tr>
<tr class="field"><th class="field-name">type:</th><td class="field-body">Type of query</td>
</tr>
<tr class="field"><th class="field-name">cls:</th><td class="field-body">Class of query</td>
</tr>
<tr class="field"><th class="field-name">data:</th><td class="field-body">Data ?</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dns-answer">
<h3>DNS Answer</h3>
<p>dpkt keeps an array of responses in dpkt.dns.DNS.RR(data) with the fields:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">name:</th><td class="field-body">Name that was queried</td>
</tr>
<tr class="field"><th class="field-name">type:</th><td class="field-body">Type of response, see dpkt.dns.*.type table</td>
</tr>
<tr class="field"><th class="field-name">cls:</th><td class="field-body">Class of response, usually internet addr: dpkt.dns.DNS_IN (1)</td>
</tr>
<tr class="field"><th class="field-name">ttl:</th><td class="field-body">The number of seconds the result can be cached</td>
</tr>
<tr class="field"><th class="field-name">rlen:</th><td class="field-body">The length of the RDATA field</td>
</tr>
<tr class="field"><th class="field-name">rdata:</th><td class="field-body">The response data. The format is dependent on the TYPE field: A(1) is IPv4 addr, CNAME(5) then a name, NS(2) is name servers, etc</td>
</tr>
<tr class="field"><th class="field-name">data:</th><td class="field-body">Data?</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="3%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">dpkt.dns.*.type</th>
<th class="head">&nbsp;</th>
<th class="head">Description, assume rr is the python dpkt.dns.DNS object</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>DNS_A</td>
<td>1</td>
<td>IPv4 address; data = socket.inet_ntoa(rr.ip)</td>
</tr>
<tr><td>DNS_AAAA</td>
<td>28</td>
<td>IPv6 address</td>
</tr>
<tr><td>DNS_CNAME</td>
<td>5</td>
<td>Conical name or alias</td>
</tr>
<tr><td>DNS_HINFO</td>
<td>13</td>
<td>OS info</td>
</tr>
<tr><td>DNS_MX</td>
<td>15</td>
<td>Mail server: an.mxname</td>
</tr>
<tr><td>DNS_NS</td>
<td>2</td>
<td>Name server info:</td>
</tr>
<tr><td>DNS_PTR</td>
<td>12</td>
<td>Map IP to hostname, data = rr.ptrname; ex. 10.27/1.168.192.in-addr.arpa. 1800 PTR mail.example.com.</td>
</tr>
<tr><td>DNS_SRV</td>
<td>33</td>
<td>Service locator; data = rr.srvname, rr.priority, rr.weight, rr.port</td>
</tr>
<tr><td>DNS_SOA</td>
<td>6</td>
<td>Start of Authorities, gives info about domain: admin, contact info, etc</td>
</tr>
<tr><td>DNS_TXT</td>
<td>16</td>
<td>Text field; data = tuple(rr.text) # Convert the list to a hashable tuple</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DNS</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">Packet</span><span class="p">):</span>
        <span class="n">hdr__</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;op&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">DNS_RD</span><span class="p">),</span>  <span class="c1"># recursive query</span>
                <span class="c1"># XXX - lists of query, RR objects</span>
                <span class="p">(</span><span class="s1">&#39;qd&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="p">(</span><span class="s1">&#39;an&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="p">(</span><span class="s1">&#39;ns&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="p">(</span><span class="s1">&#39;ar&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">)</span>

<span class="k">class</span> <span class="nc">RR</span><span class="p">(</span><span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DNS resource record.&quot;&quot;&quot;</span>
        <span class="n">__hdr__</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;1025s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">DNS_A</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">DNS_IN</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ttl&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;rlen&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;rdata&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">)</span>

<span class="k">class</span> <span class="nc">Q</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">Packet</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DNS question.&quot;&quot;&quot;</span>
        <span class="n">__hdr__</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;1025s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">DNS_A</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;cls&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">DNS_IN</span><span class="p">)</span>
        <span class="p">)</span>
</pre></div>
<p>Some examples:</p>
<div class="highlight"><pre><span></span>    <span class="n">DNS_CACHE_FLUSH</span> <span class="o">=</span> <span class="mh">0x8000</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="o">.</span><span class="n">RR</span><span class="p">(</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_TXT</span><span class="p">,</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_IN</span> <span class="o">|</span> <span class="n">DNS_CACHE_FLUSH</span><span class="p">,</span>
            <span class="n">ttl</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;www.hello.com&#39;</span><span class="p">,</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Some text&#39;</span><span class="p">)</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="o">.</span><span class="n">RR</span><span class="p">(</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_SRV</span><span class="p">,</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_IN</span> <span class="o">|</span> <span class="n">DNS_CACHE_FLUSH</span><span class="p">,</span>
            <span class="n">ttl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_ttl</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">srvname</span> <span class="o">=</span> <span class="n">full_hostname</span><span class="p">,</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="n">priority</span><span class="p">,</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span><span class="p">,</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">port</span><span class="p">)</span>
    <span class="c1"># The target host (srvname) requires to send an A record with its IP</span>
    <span class="c1"># address. We do this as if a query for it was sent.</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">full_hostname</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_A</span><span class="p">)</span>
    <span class="n">answers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ip_addr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_records</span><span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
            <span class="n">answers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="o">.</span><span class="n">RR</span><span class="p">(</span>
                    <span class="nb">type</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_A</span><span class="p">,</span>
                    <span class="bp">cls</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_IN</span> <span class="o">|</span> <span class="n">DNS_CACHE_FLUSH</span><span class="p">,</span>
                    <span class="n">ttl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_ttl</span><span class="p">,</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">ip</span> <span class="o">=</span> <span class="n">ip_addr</span><span class="p">))</span>
<span class="p">[</span><span class="n">ans</span><span class="p">]</span> <span class="o">+</span> <span class="n">answers</span>

    <span class="n">MDNS_IP_ADDR</span> <span class="o">=</span> <span class="s1">&#39;224.0.0.251&#39;</span>
    <span class="n">MDNS_PORT</span> <span class="o">=</span> <span class="mi">5353</span>
    <span class="n">resp_dns</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="p">(</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_AA</span><span class="p">,</span> <span class="c1"># Authoritative Answer.</span>
            <span class="n">rcode</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_RCODE_NOERR</span><span class="p">,</span>
            <span class="n">an</span> <span class="o">=</span> <span class="n">answers</span><span class="p">)</span>
    <span class="c1"># This property modifies the &quot;op&quot; field:</span>
    <span class="n">resp_dns</span><span class="o">.</span><span class="n">qr</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_R</span><span class="p">,</span> <span class="c1"># Response.</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resp_dns</span><span class="p">),</span> <span class="n">MDNS_IP_ADDR</span><span class="p">,</span> <span class="n">MDNS_PORT</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dnslib">
<h2>DNSLib</h2>
<p>class RR
:rclass: ?
:rdlength: ?
:rname: ?
:rtype: ?
:ttl: ?</p>
</div>
<div class="section" id="arp">
<h2>ARP</h2>
<p>The Address Resolution Protocol (ARP) is a telecommunication protocol used for resolution
of network layer addresses into link layer addresses, a critical function in
multiple-access networks. ARP is used to convert a network address (e.g. an IPv4 address)
to a physical address such as an Ethernet address (also known as a MAC address).
<cite>wiki &lt;http://en.wikipedia.org/wiki/Address_Resolution_Protocol&gt;__</cite></p>
<p>If you have the IP address, you can get the MAC address by sending an ARP message with a
broadcast MAC address (FF:FF:FF:FF:FF:FF or 00:00:00:00:00:00 (arping uses)) which every computer will read. Then the
computer with the IP address will respond with its MAC address.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">dpkt.arp.*</th>
<th class="head">&nbsp;</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>op</td>
<td>dpkt.arp.ARP_OP_REQUEST,dpkt.arp.ARP_OP_REPLY</td>
</tr>
<tr><td>sha</td>
<td>Source hardware address</td>
</tr>
<tr><td>spa</td>
<td>Source protocol address</td>
</tr>
<tr><td>tha</td>
<td>Target hardware address</td>
</tr>
<tr><td>tpa</td>
<td>Target protocol address</td>
</tr>
</tbody>
</table>
<p>This doesn't work on Windows and OSX becuase socket.PF_PACKET isn't defined, only on
linux:</p>
<div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">PF_PACKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_RAW</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;en1&#39;</span><span class="p">,</span> <span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_ARP</span><span class="p">))</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">my_mac</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;ifconfig &quot;</span> <span class="o">+</span> <span class="s1">&#39;en1&#39;</span> <span class="o">+</span> <span class="s2">&quot;| grep ether | awk &#39;{ print $2 }&#39;&quot;</span><span class="p">)</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s1">&#39;arp -i en1 -l -n 192.168.1.13&#39;</span><span class="p">)</span>

<span class="c1"># bulid an ARP reply</span>
<span class="n">arp_p</span> <span class="o">=</span> <span class="n">arp</span><span class="o">.</span><span class="n">ARP</span><span class="p">()</span>
<span class="n">arp_p</span><span class="o">.</span><span class="n">sha</span> <span class="o">=</span> <span class="n">eth_aton</span><span class="p">(</span><span class="n">src_mac</span><span class="p">)</span>
<span class="n">arp_p</span><span class="o">.</span><span class="n">spa</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">src_ip</span><span class="p">)</span>
<span class="n">arp_p</span><span class="o">.</span><span class="n">tha</span> <span class="o">=</span> <span class="n">eth_aton</span><span class="p">(</span><span class="n">dst_mac</span><span class="p">)</span>
<span class="n">arp_p</span><span class="o">.</span><span class="n">tpa</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">dst_ip</span><span class="p">)</span>
<span class="n">arp_p</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">arp</span><span class="o">.</span><span class="n">ARP_OP_REPLY</span>

<span class="n">packet</span> <span class="o">=</span> <span class="n">ethernet</span><span class="o">.</span><span class="n">Ethernet</span><span class="p">()</span>
<span class="n">packet</span><span class="o">.</span><span class="n">src</span> <span class="o">=</span> <span class="n">eth_aton</span><span class="p">(</span><span class="n">so_mac</span><span class="p">)</span>
<span class="n">packet</span><span class="o">.</span><span class="n">dst</span> <span class="o">=</span> <span class="n">eth_aton</span><span class="p">(</span><span class="n">to_mac</span><span class="p">)</span>
<span class="n">packet</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">arp_p</span>
<span class="n">packet</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_ARP</span>
</pre></div>
<p>You can also use <cite>arping</cite> to find the MAC:</p>
<div class="highlight"><pre><span></span>[kevin@Tardis docs]$ sudo arping -c 3 192.168.1.6
ARPING 192.168.1.6
Timeout
42 bytes from 40:30:04:f0:8c:50 (192.168.1.6): index=0 time=556.113 msec
42 bytes from 40:30:04:f0:8c:50 (192.168.1.6): index=1 time=164.716 msec

--- 192.168.1.6 statistics ---
3 packets transmitted, 2 packets received,  33% unanswered (0 extra)
rtt min/avg/max/std-dev = 164.716/360.415/556.113/195.698 ms
</pre></div>
<p>Or simplify it using other utils:</p>
<pre class="literal-block">
sudo arping -c 2 192.168.1.5 | grep bytes | awk '{ print $4 }'
</pre>
<div class="section" id="decoding-an-arp-packet">
<h3>Decoding an ARP Packet</h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">binascii</span>
<span class="k">def</span> <span class="nf">add_colons_to_mac</span><span class="p">(</span> <span class="n">mac_addr</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This function accepts a 12 hex digit string and converts it to a colon</span>
<span class="sd">separated string&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span>  <span class="c1"># mac_addr should always be 12 chars, we work in groups of 2 chars</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">mac_addr</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>

<span class="n">eth</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">Ethernet</span><span class="p">(</span><span class="n">pkt</span><span class="p">)</span>

<span class="c1"># should actually double check this is an ARP packet and not assume</span>
<span class="n">arp</span> <span class="o">=</span> <span class="n">eth</span><span class="o">.</span><span class="n">arp</span>
<span class="k">print</span> <span class="s2">&quot;source protocol address&quot;</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">spa</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;source hardware address&quot;</span><span class="p">,</span> <span class="n">add_colons_to_mac</span><span class="p">(</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">sha</span><span class="p">)</span> <span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;Target protocol address&quot;</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tpa</span><span class="p">)</span>      <span class="c1">#IPv4 address</span>
<span class="k">print</span> <span class="s2">&quot;target hardware address&quot;</span><span class="p">,</span> <span class="n">add_colons_to_mac</span><span class="p">(</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tha</span><span class="p">)</span> <span class="p">)</span>
<span class="n">arp_cache</span><span class="p">[</span><span class="n">arp</span><span class="o">.</span><span class="n">spa</span><span class="p">]</span> <span class="o">=</span> <span class="n">arp</span><span class="o">.</span><span class="n">sha</span>
<span class="n">add_colons_to_mac</span><span class="p">(</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">arp_cache</span><span class="p">[</span><span class="n">ip</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="icmp">
<h2>ICMP</h2>
<p>The Internet Control Message Protocol (ICMP) is one of the main protocols of the Internet
Protocol Suite. It is used by network devices, like routers, to send error messages
indicating, for example, that a requested service is not available or that a host or
router could not be reached.</p>
<p>The variable size of the ICMP packet data section has been exploited. In the well-known
&quot;Ping of death,&quot; large or fragmented ping packets are used for denial-of-service attacks.
ICMP can also be used to create covert channels for communication, as with the LOKI
exploit.</p>
<pre class="literal-block">
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             unused                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Internet Header + 64 bits of Original Data Datagram      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p>types</p>
<ul class="simple">
<li>echo reply 0</li>
<li>destination unreachable 3</li>
<li>echo request 8</li>
<li>timestamp 13</li>
<li>timestamp reply 14</li>
</ul>
</div>
<div class="section" id="icmpv6-rfc4443">
<h2>ICMPv6 <a class="reference external" href="http://www.ietf.org/rfc/rfc4443.txt">RFC4443</a></h2>
<p>The ICMPv6 messages have the following general format:</p>
<pre class="literal-block">
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                         Message Body                          +
|                                                               |
</pre>
<p>ICMPv6 messages are grouped into two classes: error messages and
informational messages.  Error messages are identified as such by a
zero in the high-order bit of their message Type field values.  Thus,
error messages have message types from 0 to 127; informational
messages have message types from 128 to 255.</p>
<p>ICMPv6 error message types:</p>
<blockquote>
1    Destination Unreachable
2    Packet Too Big
3    Time Exceeded
4    Parameter Problem</blockquote>
<p>ICMPv6 informational message types:</p>
<blockquote>
128  Echo Request
129  Echo Reply</blockquote>
<p>ICMPv6 Fields:</p>
<p>Type      1 Destination Unreachable</p>
<dl class="docutils">
<dt>Code      0 - No route to destination</dt>
<dd>1 - Communication with destination administratively prohibited
2 - Beyond scope of source address
3 - Address unreachable
4 - Port unreachable
5 - Source address failed ingress/egress policy
6 - Reject route to destination</dd>
</dl>
<p>ICMPv6 Informational Messages</p>
<div class="section" id="echo-request-message">
<h3>Echo Request Message</h3>
<pre class="literal-block">
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     Type      |     Code      |          Checksum             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |           Identifier          |        Sequence Number        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     Data ...
     +-+-+-+-+-


:Type:            128
:Code:            0
:Identifier:      An identifier to aid in matching Echo Replies to this Echo Request.  May be zero.
:Sequence Number: A sequence number to aid in matching Echo Replies to this Echo Request.  May be zero.
:Data:            Zero or more octets of arbitrary data.
</pre>
</div>
<div class="section" id="echo-reply-message">
<h3>Echo Reply Message</h3>
<pre class="literal-block">
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Identifier          |        Sequence Number        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Data ...
+-+-+-+-+-
</pre>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Type:</th><td class="field-body">129</td>
</tr>
<tr class="field"><th class="field-name">Code:</th><td class="field-body">0</td>
</tr>
<tr class="field"><th class="field-name">Identifier:</th><td class="field-body">The identifier from the invoking Echo Request message.</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Sequence Number:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">The sequence number from the invoking Echo Request message.</td>
</tr>
<tr class="field"><th class="field-name">Data:</th><td class="field-body">The data from the invoking Echo Request message.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="neighbor-discovery-nd-protocol-for-internet-protocol-version-6-ipv6">
<h2>Neighbor Discovery (ND) protocol for Internet Protocol Version 6 (IPv6)</h2>
<p><a class="reference external" href="http://www.ietf.org/rfc/rfc4861.txt">RFC4861</a></p>
<p>Nodes (hosts and routers) use Neighbor Discovery to determine the link-layer addresses for
neighbors known to reside on attached links and to quickly purge
cached values that become invalid.  Hosts also use Neighbor Discovery
to find neighboring routers that are willing to forward packets on
their behalf.  Finally, nodes use the protocol to actively keep track
of which neighbors are reachable and which are not, and to detect
changed link-layer addresses.</p>
<p>Neighbor Solicitation Message Format</p>
<p>Nodes send Neighbor Solicitations to request the link-layer address
of a target node while also providing their own link-layer address to
the target.  Neighbor Solicitations are multicast when the node needs
to resolve an address and unicast when the node seeks to verify the
reachability of a neighbor.</p>
<pre class="literal-block">
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     Type      |     Code      |          Checksum             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                           Reserved                            |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                                                               |
     +                                                               +
     |                                                               |
     +                       Target Address                          +
     |                                                               |
     +                                                               +
     |                                                               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |   Options ...
     +-+-+-+-+-+-+-+-+-+-+-+-

 IP Fields:

   Source Address
                  Either an address assigned to the interface from
                  which this message is sent or (if Duplicate Address
                  Detection is in progress [ADDRCONF]) the
                  unspecified address.
   Destination Address
                  Either the solicited-node multicast address
                  corresponding to the target address, or the target
                  address.
   Hop Limit      255

ICMP Fields:

   Type           135

   Code           0

   Checksum       The ICMP checksum.  See [ICMPv6].

   Reserved       This field is unused.  It MUST be initialized to
                  zero by the sender and MUST be ignored by the
                  receiver.

   Target Address The IP address of the target of the solicitation.
                  It MUST NOT be a multicast address.

Possible options:

   Source link-layer address
                  The link-layer address for the sender.  MUST NOT be
                  included when the source IP address is the
                  unspecified address.  Otherwise, on link layers
                  that have addresses this option MUST be included in
                  multicast solicitations and SHOULD be included in
                  unicast solicitations.
</pre>
<p>Neighbor Advertisement Message Format</p>
<p>A node sends Neighbor Advertisements in response to Neighbor
Solicitations and sends unsolicited Neighbor Advertisements in order
to (unreliably) propagate new information quickly.</p>
<pre class="literal-block">
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|R|S|O|                     Reserved                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                       Target Address                          +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Options ...
+-+-+-+-+-+-+-+-+-+-+-+-
</pre>
<p>IP Fields:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Source Address:</th><td class="field-body">An address assigned to the interface from which the advertisement is sent.</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Destination Address:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">For solicited advertisements, the Source Address of an
invoking Neighbor Solicitation or, if the solicitation's Source Address is
the unspecified address, the all-nodes multicast address. For unsolicited
advertisements typically the all-nodes multicast address.</td>
</tr>
<tr class="field"><th class="field-name">Hop Limit:</th><td class="field-body">255</td>
</tr>
</tbody>
</table>
<p>ICMP Fields:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Type:</th><td class="field-body">136</td>
</tr>
<tr class="field"><th class="field-name">Code:</th><td class="field-body">0</td>
</tr>
<tr class="field"><th class="field-name">Checksum:</th><td class="field-body">The ICMP checksum.  See [ICMPv6].</td>
</tr>
<tr class="field"><th class="field-name">R:</th><td class="field-body">Router flag.  When set, the R-bit indicates that
the sender is a router.  The R-bit is used by
Neighbor Unreachability Detection to detect a
router that changes to a host.</td>
</tr>
<tr class="field"><th class="field-name">S:</th><td class="field-body">Solicited flag.  When set, the S-bit indicates that
the advertisement was sent in response to a
Neighbor Solicitation from the Destination address.
The S-bit is used as a reachability confirmation
for Neighbor Unreachability Detection.  It MUST NOT
be set in multicast advertisements or in
unsolicited unicast advertisements.</td>
</tr>
<tr class="field"><th class="field-name">O:</th><td class="field-body">Override flag.  When set, the O-bit indicates that
the advertisement should override an existing cache
entry and update the cached link-layer address.
When it is not set the advertisement will not
update a cached link-layer address though it will
update an existing Neighbor Cache entry for which
no link-layer address is known.  It SHOULD NOT be
set in solicited advertisements for anycast
addresses and in solicited proxy advertisements.
It SHOULD be set in other solicited advertisements
and in unsolicited advertisements.</td>
</tr>
<tr class="field"><th class="field-name">Reserved:</th><td class="field-body">29-bit unused field.  It MUST be initialized to
zero by the sender and MUST be ignored by the
receiver.</td>
</tr>
<tr class="field"><th class="field-name">Target Address:</th><td class="field-body">For solicited advertisements, the Target Address
field in the Neighbor Solicitation message that
prompted this advertisement.  For an unsolicited
advertisement, the address whose link-layer address
has changed.  The Target Address MUST NOT be a
multicast address.</td>
</tr>
</tbody>
</table>
<p>Possible options:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">Target link-layer address:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body"><p class="first">The link-layer address for the target, i.e., the
sender of the advertisement.  This option MUST be
included on link layers that have addresses when
responding to multicast solicitations.  When
responding to a unicast Neighbor Solicitation this
option SHOULD be included.</p>
<p class="last">The option MUST be included for multicast
solicitations in order to avoid infinite Neighbor
Solicitation &quot;recursion&quot; when the peer node does
not have a cache entry to return a Neighbor
Advertisements message.  When responding to unicast
solicitations, the option can be omitted since the
sender of the solicitation has the correct link-
layer address; otherwise, it would not be able to
send the unicast solicitation in the first place.
However, including the link-layer address in this
case adds little overhead and eliminates a
potential race condition where the sender deletes
the cached link-layer address prior to receiving a
response to a previous solicitation.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="multicast-dns-mdns">
<h2>Multicast DNS (mDNS)</h2>
<p>The multicast Domain Name System (mDNS) resolves host names to IP addresses within small
networks that do not include a local name server. It is a zero configuration service,
using essentially the same programming interfaces, packet formats and operating semantics
as the unicast Domain Name System (DNS). While it is designed to be stand-alone capable,
it can work in concert with unicast DNS servers.</p>
<p>The mDNS Ethernet frame is a multicast UDP packet to:</p>
<ul class="simple">
<li>MAC address 01:00:5E:00:00:FB (for IPv4) or 33:33:00:00:00:FB (for IPv6)</li>
<li>IPv4 address 224.0.0.251 or IPv6 address FF02::FB</li>
<li>UDP port 5353</li>
</ul>
<p>You can simulate mDNS request with <cite>dig</cite>:</p>
<div class="highlight"><pre><span></span>[kevin@Tardis test]$ dig -p 5353 @224.0.0.251 calculon.local

; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; -p 5353 @224.0.0.251 calculon.local
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 53097
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;calculon.local.                        IN      A

;; ANSWER SECTION:
calculon.local.         10      IN      A       192.168.1.17

;; Query time: 59 msec
;; SERVER: 192.168.1.17#5353(224.0.0.251)
;; WHEN: Thu May 28 12:04:07 2015
;; MSG SIZE  rcvd: 48
</pre></div>
</div>
<div class="section" id="active-network-mapping">
<h2>Active Network Mapping</h2>
<p>Fast determination if a host is up: UDP - low cost to send packets</p>
<ol class="arabic simple">
<li>Send UDP packets to a port on a remote machine</li>
<li>Listen for ICMP (error, type=code=3) responses back. An unreachable port error means the host is up</li>
</ol>
<p>Scan a host for open ports: TCP</p>
<ol class="arabic simple">
<li>For each host that is up, start the handshake process:</li>
<li>Send a SYN packet to a port</li>
<li>Wait for the ACK (port is open) and then send a RST (reset) to close out the process and move on to the next port</li>
<li>If you don't get the ACK, then the port is closed</li>
</ol>
</div>
<div class="section" id="passive-network-mapping">
<h2>Passive Network Mapping</h2>
<p>Listen for:</p>
<ul class="simple">
<li>DNS responses: DNS_A will match names to IPv4 addresses</li>
<li>mDNS: same as above</li>
<li>mDNS: DNS_SRV will match services to IPv4 addresses</li>
</ul>
</div>
<div class="section" id="resources">
<h2>Resources</h2>
<ul class="simple">
<li><a class="reference external" href="http://en.wikipedia.org/wiki/List_of_DNS_record_types">DNS record types</a></li>
<li><a class="reference external" href="http://www.commercialventvac.com/dpkt.html#mozTocId839997">dpkt doc</a></li>
<li><a class="reference external" href="https://jon.oberheide.org/blog/2008/08/25/dpkt-tutorial-1-icmp-echo/">dpkt-tutorial-1-icmp-echo</a></li>
<li><a class="reference external" href="https://jon.oberheide.org/blog/2008/10/15/dpkt-tutorial-2-parsing-a-pcap-file/">dpkt-tutorial-2-parsing-a-pcap-file</a></li>
<li><a class="reference external" href="https://jon.oberheide.org/blog/2008/12/20/dpkt-tutorial-3-dns-spoofing/">dpkt-tutorial-3-dns-spoofing</a></li>
<li><a class="reference external" href="http://www.binarytides.com/python-packet-sniffer-code-linux/">IP Protocol headers</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Internet_Control_Message_Protocol">ICMP message</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Address_Resolution_Protocol">ARP message</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Multicast_DNS">mDNS message</a></li>
<li><a class="reference external" href="http://unixwiz.net/techtips/iguide-kaminsky-dns-vuln.html">unixwiz.net</a></li>
<li><a class="reference external" href="http://www.iana.org/assignments/dns-parameters/dns-parameters.xhtml#dns-parameters-6">IANA DNS types</a></li>
<li><a class="reference external" href="http://www.ietf.org">Internet Engineering Task Force</a></li>
</ul>
</div>
<div class="section" id="airplay">
<h2>Airplay</h2>
<p><a class="reference external" href="http://nto.github.io/AirPlay.html#audio-airportexpressauthentication">http://nto.github.io/AirPlay.html#audio-airportexpressauthentication</a></p>
</div>
<div class="section" id="misc">
<h2>Misc</h2>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">AppKit</span>
<span class="c1"># Create instance of OS X notification center</span>
<span class="n">notification_center</span> <span class="o">=</span> <span class="n">AppKit</span><span class="o">.</span><span class="n">NSUserNotificationCenter</span><span class="o">.</span><span class="n">defaultUserNotificationCenter</span><span class="p">()</span>
<span class="c1"># Create new notification instance</span>
<span class="n">notification</span> <span class="o">=</span> <span class="n">AppKit</span><span class="o">.</span><span class="n">NSUserNotification</span><span class="o">.</span><span class="n">alloc</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="n">notification</span><span class="o">.</span><span class="n">setTitle_</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">notification</span><span class="o">.</span><span class="n">setSubtitle_</span><span class="p">(</span><span class="n">subtitle</span><span class="p">)</span>
<span class="n">notification</span><span class="o">.</span><span class="n">setInformativeText_</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="c1"># Deliver OS notifications</span>
<span class="n">notification_center</span><span class="o">.</span><span class="n">deliverNotification_</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
</pre></div>
</div>


<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2016&nbsp;Kevin J. Walchko&nbsp;::</li>
    <li class="footer"><a href="../../../..">Planet Express </a>&nbsp;::</li>
    <li class="footer"><a href="https://github.com/getpelican">pelican</a></li>
    <!-- <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed">Content CC BY-NC</a>&nbsp;::</li> -->
    <!-- <li class="footer"><a href="http://fontawesome.io">Font Awesome <i class="fa fa-flag"></i></a></li> -->
    <!-- <li class="footer"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></li> -->
</ul>
<span><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></span>
</div></body>
</html>