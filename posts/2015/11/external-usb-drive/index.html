<!-- This is for the actual single article -->


<!DOCTYPE html>
<html lang="en">
<head>
  <title>External USB Drive | Planet Express</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<meta name="description" content="Setting up a hard drive to work with Raspbian"><meta name="author" content="walchko">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="../../../../theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link href="../../../../theme/css/pygments.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../../../../favicon.ico" type="image/x-icon">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="../../../..">Planet Express</a></div>
  <div class="small">Our crew is replaceable. Your package isn't.</div>
  <div class="nav">
  <li><a href="../../../../about.html">About Me</a></li>
  <li><a href="../../../../colophon.html">Colophon</a></li>
  <li><a href="../../../../categories.html">Topics</a></li>
  <li><a href="../../../../archives.html">Blog</a></li>
  </div>
  <div class="nav social">
<ul>
    <li><a href="http://github.com/walchko"><i class="fa fa-github-alt fa-2x"></i></a></li>
    <li><a href="http://stackoverflow.com/users/5374768/kevin"><i class="fa fa-stack-overflow fa-2x"></i></a></li>
    <li><a href="http://raspberrypi.stackexchange.com/users/1677/kevin"><i class="fa fa-stack-exchange fa-2x"></i></a></li>
</ul>  </div>
</div>    <div id="main">

<!--  -->

<h2><a href="../../../../posts/2015/11/external-usb-drive">External USB Drive</a></h2>
<h5><i class="icon-feather"></i> Sat 28 November 2015
<i class="icon-bookmarks"></i>
</h5>

<div class="figure align-center">
<img alt="" src="../../../../blog/raspbian/pics/usb.png" style="width: 200px;" />
</div>
<p>A good resource is
<a class="reference external" href="http://devtidbits.com/2013/03/21/using-usb-external-hard-disk-flash-drives-with-to-your-raspberry-pi/">here</a></p>
<div class="section" id="setup">
<h2>Setup</h2>
<p>First connect the drive and find it:</p>
<pre class="literal-block">
pi&#64;calculon ~ $ sudo fdisk -l

Disk /dev/mmcblk0: 15.9 GB, 15931539456 bytes
4 heads, 16 sectors/track, 486192 cylinders, total 31116288 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x000981cb

        Device Boot      Start         End      Blocks   Id  System
/dev/mmcblk0p1            8192      122879       57344    c  W95 FAT32 (LBA)
/dev/mmcblk0p2          122880    31116287    15496704   83  Linux

WARNING: GPT (GUID Partition Table) detected on '/dev/sda'! The util fdisk doesn't support GPT. Use GNU Parted.


Disk /dev/sda: 640.1 GB, 640135028736 bytes
255 heads, 63 sectors/track, 77825 cylinders, total 1250263728 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1  1250263727   625131863+  ee  GPT
</pre>
<p>Make a mount point and mount and/or unmount the drive.</p>
<pre class="literal-block">
pi&#64;calculon ~ $ sudo mkdir /mnt/usbdrive
pi&#64;calculon ~ $ sudo mount /dev/sda1 /mnt/usbdrive
pi&#64;calculon ~ $ sudo umount /dev/sda1
</pre>
</div>
<div class="section" id="formatting-disk">
<h2>Formatting Disk</h2>
<p>Starting with a USB hard drive 640GB formated in OSX's HSF+, I needed to
change it to ext4:</p>
<pre class="literal-block">
pi&#64;calculon ~ $ sudo parted /dev/sda
GNU Parted 2.3
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) p
Model: Maxtor OneTouch (scsi)
Disk /dev/sda: 640GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start  End  Size  File system  Name  Flags

(parted) mkpart primary ext4 1 640000
(parted) p
Model: Maxtor OneTouch (scsi)
Disk /dev/sda: 640GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End    Size   File system  Name     Flags
 1      1049kB  640GB  640GB               primary

(parted) quit
Information: You may need to update /etc/fstab.
</pre>
<p><strong>Note</strong> in the <tt class="docutils literal">mkpart</tt> line, the start and stop locations are in MB.</p>
<pre class="literal-block">
pi&#64;calculon ~ $ sudo mkfs.ext4 /dev/sda1 -L Calculon
mke2fs 1.42.5 (29-Jul-2012)
Filesystem label=Calculon
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
39067648 inodes, 156249856 blocks
7812492 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=0
4769 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
    4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,
    102400000

Allocating group tables: done
Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done
</pre>
<p>Now mount the drive and double check it:</p>
<pre class="literal-block">
pi&#64;calculon ~ $ sudo mount /dev/sda1 /mnt/usbdrive
pi&#64;calculon ~ $ df -h
Filesystem      Size  Used Avail Use% Mounted on
rootfs           15G  3.7G   11G  27% /
/dev/root        15G  3.7G   11G  27% /
devtmpfs        112M     0  112M   0% /dev
tmpfs            24M  240K   23M   2% /run
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs            47M     0   47M   0% /run/shm
/dev/mmcblk0p1   56M  9.8M   47M  18% /boot
/dev/sda1       587G   70M  557G   1% /mnt/usbdrive
</pre>
<p>Fix permissions:</p>
<pre class="literal-block">
pi&#64;calculon ~ $ sudo chown pi:pi /mnt/usbdrive
pi&#64;calculon ~ $ sudo chmod 777 /mnt/usbdrive
pi&#64;calculon ~ $ sudo ls /mnt/usbdrive -alh
total 24K
drwxrwxrwx 3 pi   pi   4.0K Dec 14 20:45 .
drwxr-xr-x 3 root root 4.0K Dec 14 18:24 ..
drwx------ 2 root root  16K Dec 14 20:45 lost+found
</pre>
</div>
<div class="section" id="automounting">
<h2>Automounting</h2>
<p>Add the following to fstab so it mounts on boot.</p>
<pre class="literal-block">
sudo nano /etc/fstab
/dev/sda1 /mnt/usbdisk auto defaults,user 0 1
</pre>
<p>This sets the file system to <tt class="docutils literal">auto</tt> and <tt class="docutils literal">user</tt> enables write
permissions for all users. The 0 is for debugging and 1 is for a file
system check at boot. You can test this out by:</p>
<p>For a USB thumb drive formated in <tt class="docutils literal">vfat</tt> you can do:</p>
<pre class="literal-block">
# &lt;file system&gt; &lt;mount pt&gt;     &lt;type&gt;   &lt;options&gt;                  &lt;dump&gt;  &lt;pass&gt;
/dev/sda1       /mnt/usbdisk    auto    auto,user,uid=1000,gid=1000  0       2
</pre>
<p>Since I leave the usb drive in all the time, I have the option <tt class="docutils literal">auto</tt> to always mount it.
When the drive is mounted, user <tt class="docutils literal">pi</tt> has ownership with the <tt class="docutils literal">uid</tt> and <tt class="docutils literal">gid</tt>
options. How do you find the user/grp id?</p>
<pre class="literal-block">
pi&#64;calculon /mnt $ id -u pi
1000
pi&#64;calculon /mnt $ id -g pi
1000
pi&#64;calculon /mnt $ id pi
uid=1000(pi) gid=1000(pi) groups=1000(pi),4(adm),20(dialout),24(cdrom),27(sudo),
29(audio),44(video),46(plugdev),60(games),100(users),101(input),108(netdev),
999(spi),998(i2c),997(gpio)
</pre>
<pre class="literal-block">
sudo mount -a
</pre>
</div>
<div class="section" id="swap-partition-on-hard-drive">
<h2>Swap Partition on Hard Drive</h2>
<p>Don't ever make a swap partition on the sd card ... it is too slow and
will reduce the card's life span.</p>
<ol class="arabic">
<li><p class="first">Create a partition for swap on say <tt class="docutils literal">/dev/sda2</tt> following the method
above, then exit <tt class="docutils literal">parted</tt>.</p>
</li>
<li><p class="first">Use <tt class="docutils literal">mkswap /dev/sda2</tt> to set it up.</p>
</li>
<li><p class="first">Edit <tt class="docutils literal">/etc/fstab</tt> and add the following line:
<tt class="docutils literal">/dev/sda2 none swap sw 0 0</tt></p>
</li>
<li><p class="first">Get rid of RPi's file base swap by removing the packages:
<tt class="docutils literal">sudo <span class="pre">apt-get</span> remove <span class="pre">dphy-swapfile</span></tt></p>
</li>
<li><p class="first">Make sure swap is working: <tt class="docutils literal">swapon <span class="pre">-s</span></tt></p>
<pre class="literal-block">
pi&#64;calculon ~ $ swapon -s Filename Type Size Used Priority /dev/sda2
partition 4295676 0 -1
</pre>
</li>
</ol>
</div>


<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2016&nbsp;Kevin J. Walchko&nbsp;::</li>
    <li class="footer"><a href="../../../..">Planet Express </a>&nbsp;::</li>
    <li class="footer"><a href="https://github.com/getpelican">pelican</a></li>
    <!-- <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed">Content CC BY-NC</a>&nbsp;::</li> -->
    <!-- <li class="footer"><a href="http://fontawesome.io">Font Awesome <i class="fa fa-flag"></i></a></li> -->
    <!-- <li class="footer"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></li> -->
</ul>
<span><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></span>
</div></body>
</html>