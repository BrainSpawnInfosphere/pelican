<!-- This is for the actual single article -->


<!DOCTYPE html>
<html lang="en">
<head>
  <title>Services | Planet Express</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<meta name="description" content="Setting up services on Raspbian/Jessie"><meta name="author" content="walchko">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="../../../../theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link href="../../../../theme/css/pygments.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../../../../favicon.ico" type="image/x-icon">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="../../../..">Planet Express</a></div>
  <div class="small">Our crew is replaceable. Your package isn't.</div>
  <div class="nav">
  <li><a href="../../../../about.html">About Me</a></li>
  <li><a href="../../../../colophon.html">Colophon</a></li>
  <li><a href="../../../../categories.html">Topics</a></li>
  <li><a href="../../../../archives.html">Blog</a></li>
  </div>
  <div class="nav social">
<ul>
    <li><a href="http://github.com/walchko"><i class="fa fa-github-alt fa-2x"></i></a></li>
    <li><a href="http://stackoverflow.com/users/5374768/kevin"><i class="fa fa-stack-overflow fa-2x"></i></a></li>
    <li><a href="http://raspberrypi.stackexchange.com/users/1677/kevin"><i class="fa fa-stack-exchange fa-2x"></i></a></li>
</ul>  </div>
</div>    <div id="main">

<!--  -->

<h2><a href="../../../../posts/2015/11/services">Services</a></h2>
<h5><i class="icon-feather"></i> Sun 29 November 2015
<i class="icon-bookmarks"></i>
</h5>

<p>To have a service <tt class="docutils literal">archeyjs</tt> run at boot and reload if it goes down, create
a file <tt class="docutils literal">/etc/systemd/system/archeyjs.service</tt>:</p>
<pre class="literal-block">
[Service]
ExecStart=/usr/local/bin/archeyjs
Restart=always
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=archeyjs
User=pi
Group=pi
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
</pre>
<p>Then do:</p>
<pre class="literal-block">
sudo systemctl enable archeyjs
sudo systemctl start archeyjs
</pre>
<p>Now you can use <tt class="docutils literal">sudo systemctl start|stop|status archeyjs.service</tt> to start,
stop, or find the current status of the server.</p>
<pre class="literal-block">
pi&#64;zoidberg:~/tmp/node $ systemctl status archeyjs
● archeyjs.service
   Loaded: loaded (/etc/systemd/system/archeyjs.service; enabled)
   Active: active (running) since Fri 2016-12-30 22:54:10 MST; 6s ago
 Main PID: 2873 (node)
   CGroup: /system.slice/archeyjs.service
           └─2873 node /usr/bin/archeyjs

Dec 30 22:54:10 zoidberg systemd[1]: Started archeyjs.service.
</pre>
<p>If you make any changes to the service file, you need to reload it:</p>
<pre class="literal-block">
sudo systemctl daemon-reload
</pre>
<p>You can also do:</p>
<pre class="literal-block">
pi&#64;zoidberg ~ $ service archeyjs status
● archeyjs.service
   Loaded: loaded (/etc/systemd/system/archeyjs.service; enabled)
   Active: active (running) since Fri 2016-12-30 22:54:10 MST; 6 days ago
 Main PID: 2873 (node)
   CGroup: /system.slice/archeyjs.service
           └─2873 node /usr/bin/archeyjs
</pre>
<pre class="literal-block">
pi&#64;zoidberg ~ $ service bluetooth status
● bluetooth.service - Bluetooth service
   Loaded: loaded (/lib/systemd/system/bluetooth.service; enabled)
   Active: active (running) since Fri 2016-12-30 20:35:36 MST; 1 weeks 0 days ago
     Docs: man:bluetoothd(8)
 Main PID: 586 (bluetoothd)
   Status: &quot;Running&quot;
   CGroup: /system.slice/bluetooth.service
           └─586 /usr/lib/bluetooth/bluetoothd
</pre>
<p><strong>This has changed with Jessie, don't use anything below with current versions of Raspbian</strong></p>
<hr class="docutils" />
<p>To setup daemons to run at boot time or be able to easily start/stop
them, we need to the init system. Create a file in <tt class="docutils literal">/etc/init.d</tt> like
the one below:</p>
<pre class="literal-block">
# /etc/init.d/netscan
#

# Some things that run always
DAEMON_USER=root
DIR=/home/pi/github/netscan
DAEMON_NAME=netscan
SERVER_NAME=simple_server
DAEMON=$DIR/$DAEMON_NAME.py
SERVER=$DIR/$SERVER_NAME.py
PIDFILE=/var/run/$DAEMON_NAME.pid
SERVER_PIDFILE=/var/run/$SERVER_NAME.pid

. /lib/lsb/init-functions

# Carry out specific functions when asked to by the system
case &quot;$1&quot; in
  start)
    echo &quot;Starting netscan&quot;
    log_daemon_msg &quot;Starting system $DAEMON_NAME daemon&quot;
    start-stop-daemon --start --background --pidfile $PIDFILE --make-pidfile --u
ser $DAEMON_USER --chuid $DAEMON_USER --startas $DAEMON
    start-stop-daemon --start --background --pidfile $SERVER_PIDFILE --make-pidf
ile --user pi --chuid pi --startas $SERVER
    log_end_msg $?
    ;;
  stop)
    log_daemon_msg &quot;Stopping system $DAEMON_NAME daemon&quot;
    start-stop-daemon --stop --pidfile $PIDFILE --retry 10
    start-stop-daemon --stop --pidfile $SERVER_PIDFILE --retry 10
    log_end_msg $?
    ;;
  status)
    status_of_proc $SERVER_NAME $SERVER &amp;&amp; status_of_proc $DAEMON_NAME $DAEMON &amp;
&amp; exit 0 || exit $?
    ;;
  *)
    echo &quot;Usage: /etc/init.d/netscan {start|status|stop}&quot;
    exit 1
    ;;
esac

exit 0
</pre>
<p>Another example:</p>
<pre class="literal-block">
# /etc/init.d/nodesjs
#

# Some things that run always
DAEMON_USER=root
DIR=/usr/local/bin
DAEMON_NAME=http-server
DAEMON=$DIR/$DAEMON_NAME
PIDFILE=/var/run/$DAEMON_NAME.pid
DAEMON_full=&quot;$DAEMON -- /mnt/usbdrive -p 9000 -s&quot;

. /lib/lsb/init-functions

# Carry out specific functions when asked to by the system
case &quot;$1&quot; in
  start)
        echo &quot;Starting Nodejs HTTP Server for movies&quot;
        echo $DAEMON_full
        log_daemon_msg &quot;Starting system $DAEMON_NAME daemon&quot;
        start-stop-daemon --start --background --pidfile $PIDFILE --make-pidfile --user $DAEMON_USER --chuid $DAEMON_USER --startas $DAEMON_full
        log_end_msg $?
        ;;
  stop)
        log_daemon_msg &quot;Stopping system $DAEMON_NAME daemon&quot;
        start-stop-daemon --stop --pidfile $PIDFILE --retry 10
        log_end_msg $?
        ;;
  status)
        status_of_proc status_of_proc $DAEMON_NAME $DAEMON &amp;&amp; exit 0 || exit $?
        ;;
  *)
        echo &quot;Usage: /etc/init.d/nodejs-movies {start|status|stop}&quot;
        exit 1
        ;;
esac

exit 0
</pre>
<p>Change the permissions with:</p>
<pre class="literal-block">
chmod 755 /etc/init.d/netscan
</pre>
<p>Add the service to the proper run levels:</p>
<pre class="literal-block">
update-rc.d netscan defaults
</pre>
<div class="section" id="references">
<h2>References</h2>
<ul class="simple">
<li><a class="reference external" href="http://www.thegeekstuff.com/2012/03/lsbinit-script/">thegeekstuff</a></li>
<li><a class="reference external" href="https://www.debian-administration.org/article/28/Making_scripts_run_at_boot_time_with_Debian">debian-administration.org</a></li>
</ul>
</div>


<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2016&nbsp;Kevin J. Walchko&nbsp;::</li>
    <li class="footer"><a href="../../../..">Planet Express </a>&nbsp;::</li>
    <li class="footer"><a href="https://github.com/getpelican">pelican</a></li>
    <!-- <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed">Content CC BY-NC</a>&nbsp;::</li> -->
    <!-- <li class="footer"><a href="http://fontawesome.io">Font Awesome <i class="fa fa-flag"></i></a></li> -->
    <!-- <li class="footer"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></li> -->
</ul>
<span><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></span>
</div></body>
</html>