<!-- This is for the actual single article -->


<!DOCTYPE html>
<html lang="en">
<head>
  <title>PS4 Controller | Planet Express</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<meta name="description" content="How to hook up your PS4 controller to Raspbian."><meta name="author" content="walchko">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="../../../../theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link href="../../../../theme/css/pygments.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../../../../favicon.ico" type="image/x-icon">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="../../../..">Planet Express</a></div>
  <div class="small">Our crew is replaceable. Your package isn't.</div>
  <div class="nav">
  <li><a href="../../../../about.html">About Me</a></li>
  <li><a href="../../../../colophon.html">Colophon</a></li>
  <li><a href="../../../../categories.html">Topics</a></li>
  <li><a href="../../../../archives.html">Blog</a></li>
  </div>
  <div class="nav social">
<ul>
    <li><a href="http://github.com/walchko"><i class="fa fa-github-alt fa-2x"></i></a></li>
    <li><a href="http://stackoverflow.com/users/5374768/kevin"><i class="fa fa-stack-overflow fa-2x"></i></a></li>
    <li><a href="http://raspberrypi.stackexchange.com/users/1677/kevin"><i class="fa fa-stack-exchange fa-2x"></i></a></li>
</ul>  </div>
</div>    <div id="main">

<!--  -->

<h2><a href="../../../../posts/2016/05/ps4-controller">PS4 Controller</a></h2>
<h5><i class="icon-feather"></i> Thu 05 May 2016
<i class="icon-bookmarks"></i>
</h5>

<div class="section" id="finally-got-working">
<h2>Finally Got Working</h2>
<p>There are issues with <a class="reference external" href="http://raspberrypi.stackexchange.com/questions/45570/how-do-i-make-serial-work-on-the-raspberry-pi3">serial port on rpi 3</a></p>
<pre class="literal-block">
pi&#64;zoidberg ~ $ more /boot/cmdline.txt
dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4
elevator=deadline fsck.repair=yes rootwait
</pre>
<pre class="literal-block">
sudo apt-get install joystick
</pre>
<p>The info below will allow you to connect a PS4 and get you <tt class="docutils literal">/dev/input/js0</tt> however,
only the touch pad worked when I did <tt class="docutils literal">jstest /dev/input/js0</tt>
(or you could do <tt class="docutils literal">cat /dev/input/js0</tt> but only strange characters appear, but it
works too).</p>
<p>So do <tt class="docutils literal">pip install ds4drv</tt> (you need version 0.5.1 to work on jessie/rpi3) and
it will go through and pair your device. Also follow the instructions on
<a class="reference external" href="https://github.com/chrippa/ds4drv">ds4drv</a> to setup udev right. Then run:</p>
<pre class="literal-block">
ds4drv
</pre>
<p>This will pair and setup your joystick to work (I use SDL2 as my joystick interface)
and it work great.</p>
<p>Also note, the light bar in the front should be strong, bright blue when paired.
Using the instructions below, and only getting it to partially work, my light
bar was blue, but dimm.</p>
</div>
<div class="section" id="references">
<h2>References</h2>
<ul class="simple">
<li><a class="reference external" href="http://www.psdevwiki.com/ps4/DualShock_4">PS4 wiki</a></li>
<li><a class="reference external" href="http://eleccelerator.com/wiki/index.php?title=DualShock_4">http://eleccelerator.com/wiki/index.php?title=DualShock_4</a></li>
<li><a class="reference external" href="https://github.com/chrippa/ds4drv">ds4drv</a></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="older-but-useful-info">
<h2>Older but useful info</h2>
<p>Reference <a class="reference external" href="http://pes.mundayweb.com/html/Using%20PS4%20Control%20Pads%20via%20Bluetooth.html">here</a></p>
<p>Requirements</p>
<ol class="arabic simple">
<li>A compatible Bluetooth 2.1+ USB adapter</li>
<li>At least one official Sony PlayStation 4 control pad</li>
</ol>
</div>
<div class="section" id="setup">
<h2>Setup</h2>
<p>Log into your Raspberry Pi either via SSH or using a keyboard at the console.</p>
<pre class="literal-block">
sudo systemctl enable bluetooth.service
sudo systemctl start bluetooth.service
</pre>
<p>Pairing using <tt class="docutils literal">bluetoothctl</tt>:</p>
<pre class="literal-block">
sudo bluetoothctl
</pre>
<p>Some of the commands available:</p>
<pre class="literal-block">
[bluetooth]# help
Available commands:
  list                       List available controllers
  show [ctrl]                Controller information
  select &lt;ctrl&gt;              Select default controller
  devices                    List available devices
  paired-devices             List paired devices
  power &lt;on/off&gt;             Set controller power
  pairable &lt;on/off&gt;          Set controller pairable mode
  discoverable &lt;on/off&gt;      Set controller discoverable mode
  agent &lt;on/off/capability&gt;  Enable/disable agent with given capability
  default-agent              Set agent as the default one
  scan &lt;on/off&gt;              Scan for devices
  info &lt;dev&gt;                 Device information
  pair &lt;dev&gt;                 Pair with device
  trust &lt;dev&gt;                Trust device
  untrust &lt;dev&gt;              Untrust device
  block &lt;dev&gt;                Block device
  unblock &lt;dev&gt;              Unblock device
  remove &lt;dev&gt;               Remove device
  connect &lt;dev&gt;              Connect device
  disconnect &lt;dev&gt;           Disconnect device
  version                    Display version
  quit                       Quit program
</pre>
<p>At the <tt class="docutils literal">bluetoothctl</tt> prompt type the following commands:</p>
<pre class="literal-block">
agent on
default-agent
power on
discoverable on
pairable on
scan on
</pre>
<p><strong>Note</strong> I had to hit <tt class="docutils literal"><span class="pre">ctrl-c</span></tt> to get it to work after running <tt class="docutils literal">bluetoothctl</tt>
for some reason.</p>
<p>Example output can be found below:</p>
<pre class="literal-block">
[pi&#64;pes ~]$ bluetoothctl
[NEW] Controller 00:15:XX:XX:XX:XX pes [default]
[bluetooth]# agent on
Agent registered
[bluetooth]# default-agent
Default agent request successful
[bluetooth]# power on
Changing power on succeeded
[bluetooth]# discoverable on
Changing discoverable on succeeded
[CHG] Controller 00:15:XX:XX:XX:XX Discoverable: yes
[bluetooth]# pairable on
Changing pairable on succeeded
[bluetooth]# scan on
Discovery started
</pre>
<p>Now put your Sony PlayStation 4 control pad into pairable mode by holding down
the Share and PlayStation buttons until the light bar on the control pad flashes
yellow. After a few seconds you should see at the <tt class="docutils literal">bluetoothctl</tt> prompt that
your control pad has been discovered, e.g.:</p>
<pre class="literal-block">
[bluetooth]# scan on
Discovery started
[CHG] Controller 00:15:XX:XX:XX:XX Discovering: yes
[NEW] Device 00:3C:XX:XX:XX:XX 00-3C-XX-XX-XX-XX
[NEW] Device 1C:66:XX:XX:XX:XX 1C-66-XX-XX-XX-XX
[CHG] Device 1C:66:XX:XX:XX:XX LegacyPairing: no
[CHG] Device 1C:66:XX:XX:XX:XX Name: Wireless Controller
[CHG] Device 1C:66:XX:XX:XX:XX Alias: Wireless Controller
[CHG] Device 1C:66:XX:XX:XX:XX LegacyPairing: yes
[CHG] Device 1C:66:XX:XX:XX:XX Class: 0x002508
[CHG] Device 1C:66:XX:XX:XX:XX Icon: input-gaming
</pre>
<p>Take a note of the Bluetooth MAC address shown for “Wireless Controller”, e.g.
1C:66:XX:XX:XX:XX in my case.</p>
<p>Now type:</p>
<pre class="literal-block">
pair MAC
</pre>
<p>where MAC is the MAC address of your control pad and when prompted enter 0000
as the PIN, for example:</p>
<pre class="literal-block">
[bluetooth]# pair 1C:66:XX:XX:XX:XX
Attempting to pair with 1C:66:XX:XX:XX:XX
[CHG] Device 1C:66:XX:XX:XX:XX Connected: yes
Request PIN code
[agent] Enter PIN code: 0000
[CHG] Device 1C:66:XX:XX:XX:XX Modalias: usb:v054Cp05C4d0100
[CHG] Device 1C:66:XX:XX:XX:XX UUIDs: 00001124-0000-1000-8000-00805f9b34fb
[CHG] Device 1C:66:XX:XX:XX:XX UUIDs: 00001200-0000-1000-8000-00805f9b34fb
[CHG] Device 1C:66:XX:XX:XX:XX Paired: yes
Pairing successful
[CHG] Device 1C:66:XX:XX:XX:XX Connected: no
</pre>
<p>Next we must trust the control pad by running:</p>
<pre class="literal-block">
trust MAC
</pre>
<p>where MAC is the MAC address of your control pad, for example:</p>
<pre class="literal-block">
[bluetooth]# trust 1C:66:XX:XX:XX:XX
[CHG] Device 1C:66:XX:XX:XX:XX Trusted: yes
Changing 1C:66:XX:XX:XX:XX trust succeeded
</pre>
<p>Finally, run the following command to connect to the control pad:</p>
<pre class="literal-block">
[bluetooth]# connect 1C:66:XX:XX:XX:XX
Attempting to connect to 1C:66:XX:XX:XX:XX
[CHG] Device 1C:66:XX:XX:XX:XX Connected: yes
Connection successful
</pre>
<p>Then type <tt class="docutils literal">quit</tt> to exit back to the command prompt. You should now see that
the light bar on your control pad is blue.</p>
<p>Other useful info:</p>
<pre class="literal-block">
[bluetooth]# info 1C:66:xx:xx:xx:xx
Device 1C:66:xx:xx:xx:xx
        Name: Wireless Controller
        Alias: Wireless Controller
        Class: 0x002508
        Icon: input-gaming
        Paired: yes
        Trusted: yes
        Blocked: no
        Connected: yes
        LegacyPairing: no
        UUID: Human Interface Device... (00001124-0000-1000-8000-00805f9b34fb)
        UUID: PnP Information           (00001200-0000-1000-8000-00805f9b34fb)
        Modalias: usb:v054Cp05C4d0100
</pre>
<pre class="literal-block">
[bluetooth]# paired-devices
Device 1C:66:xx:xx:xx:xx Wireless Controller
</pre>
<pre class="literal-block">
[bluetooth]# connect 1C:66:xx:xx:xx:xx
Attempting to connect to 1C:66:xx:xx:xx:xx
Connection successful
</pre>
<pre class="literal-block">
[bluetooth]# disconnect 1C:66:6D:76:9B:B4
Attempting to disconnect from 1C:66:xx:xx:xx:xx
Successful disconnected
[CHG] Device 1C:66:xx:xx:xx:xx Connected: no
</pre>
</div>
<div class="section" id="reconnect-after-reboot">
<h2>Reconnect after reboot</h2>
<ol class="arabic simple">
<li>put PS4 controller into pairable mode (press PS button and Share), the front light bar will flash.</li>
<li><dl class="first docutils">
<dt>run <tt class="docutils literal">bluetoothctl</tt></dt>
<dd><ol class="first last arabic">
<li>connect 1C:66:6D:76:9B:B4</li>
</ol>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="debug">
<h2>Debug</h2>
<pre class="literal-block">
cat /dev/input/js0
</pre>
<p>You should see some strange characters appear as you use the joystick.</p>
<pre class="literal-block">
sudo apt-get install joystick
jstest /dev/input/js0
</pre>
</div>


<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2016&nbsp;Kevin J. Walchko&nbsp;::</li>
    <li class="footer"><a href="../../../..">Planet Express </a>&nbsp;::</li>
    <li class="footer"><a href="https://github.com/getpelican">pelican</a></li>
    <!-- <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed">Content CC BY-NC</a>&nbsp;::</li> -->
    <!-- <li class="footer"><a href="http://fontawesome.io">Font Awesome <i class="fa fa-flag"></i></a></li> -->
    <!-- <li class="footer"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></li> -->
</ul>
<span><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></span>
</div></body>
</html>