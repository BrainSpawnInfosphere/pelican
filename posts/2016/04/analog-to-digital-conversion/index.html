<!-- This is for the actual single article -->


<!DOCTYPE html>
<html lang="en">
<head>
  <title>Analog-to-Digital Conversion | Planet Express</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<meta name="description" content="Hooking up an MCP3008 or MCP3208 ADC to an RPi"><meta name="author" content="walchko">  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
  <meta http-equiv="Cache-Control" content="max-age=604800, must-revalidate" />
  <link href="../../../../theme/css/screen.css" rel="stylesheet" type="text/css" />
  <link href="../../../../theme/css/pygments.css" rel="stylesheet" type="text/css" />
  <link rel="icon" href="../../../../favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="../../../../favicon.ico" type="image/x-icon">
</head>
<body>
<div id="outer-wrapper">
<div id="header-wrapper">
  <div class="logo"><a href="../../../..">Planet Express</a></div>
  <div class="small">Our crew is replaceable. Your package isn't.</div>
  <div class="nav">
  <li><a href="../../../../about.html">About Me</a></li>
  <li><a href="../../../../colophon.html">Colophon</a></li>
  <li><a href="../../../../categories.html">Topics</a></li>
  <li><a href="../../../../archives.html">Blog</a></li>
  </div>
  <div class="nav social">
<ul>
    <li><a href="http://github.com/walchko"><i class="fa fa-github-alt fa-2x"></i></a></li>
    <li><a href="http://stackoverflow.com/users/5374768/kevin"><i class="fa fa-stack-overflow fa-2x"></i></a></li>
    <li><a href="http://raspberrypi.stackexchange.com/users/1677/kevin"><i class="fa fa-stack-exchange fa-2x"></i></a></li>
</ul>  </div>
</div>    <div id="main">

<!--  -->

<h2><a href="../../../../posts/2016/04/analog-to-digital-conversion">Analog-to-Digital Conversion</a></h2>
<h5><i class="icon-feather"></i> Sun 17 April 2016
<i class="icon-bookmarks"></i>
</h5>

<div class="figure align-center">
<img alt="" src="../../../../blog/robots/pics/MCP3008_MCP3208.jpg" style="width: 400px;" />
</div>
<p>Even though I have an MCP3208, which is a 12b ADC, I only get 10b of resolution
out of these. Need to figure out why. They both <em>appeared</em> to work the same with
no advantage either way.</p>
<div class="section" id="kernel-overlay">
<h2>Kernel Overlay</h2>
<p>Setup of the overlay to load at boot:</p>
<pre class="literal-block">
sudo pico /boot/config.txt
dtparam=spi=on
dtoverlay=mcp3008:spi0-0-present
</pre>
<p>Then using the polling C code below:</p>
<pre class="literal-block">
root&#64;rpi3:~/mcp3008-poll# ./mcp3008-poll -d0 0

(use ctrl-c to stop)

ADC                0
Read  1036000:   621  ^C

Summary
  Elapsed: 56.93 seconds
    Reads: 1037028
     Rate: 18215.51 Hz
</pre>
</div>
<div class="section" id="python">
<h2>Python</h2>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Import SPI library (for hardware SPI) and MCP3008 library.</span>
<span class="kn">import</span> <span class="nn">Adafruit_GPIO.SPI</span> <span class="kn">as</span> <span class="nn">SPI</span>
<span class="kn">import</span> <span class="nn">Adafruit_MCP3008</span>

<span class="c1"># Hardware SPI configuration:</span>
<span class="n">SPI_PORT</span>   <span class="o">=</span> <span class="mi">0</span>
<span class="n">SPI_DEVICE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mcp</span> <span class="o">=</span> <span class="n">Adafruit_MCP3008</span><span class="o">.</span><span class="n">MCP3008</span><span class="p">(</span><span class="n">spi</span><span class="o">=</span><span class="n">SPI</span><span class="o">.</span><span class="n">SpiDev</span><span class="p">(</span><span class="n">SPI_PORT</span><span class="p">,</span> <span class="n">SPI_DEVICE</span><span class="p">))</span>


<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Reading MCP3008 values, press Ctrl-C to quit...&#39;</span><span class="p">)</span>
<span class="c1"># Print nice channel column headers.</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;| {0:&gt;4} | {1:&gt;4} | {2:&gt;4} | {3:&gt;4} | {4:&gt;4} | {5:&gt;4} | {6:&gt;4} | {7:&gt;4} |&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">57</span><span class="p">)</span>
<span class="c1"># Main program loop.</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># Read all the ADC channel values in a list.</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="c1"># The read_adc function will get the value of the specified channel (0-7).</span>
        <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mcp</span><span class="o">.</span><span class="n">read_adc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># Print the ADC values.</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;| {0:&gt;4} | {1:&gt;4} | {2:&gt;4} | {3:&gt;4} | {4:&gt;4} | {5:&gt;4} | {6:&gt;4} | {7:&gt;4} |&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))</span>
    <span class="c1"># Pause for half a second.</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="references">
<h2>References</h2>
<p>---</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/adafruit/Adafruit_Python_MCP3008">Adafruit MCP3008</a></li>
<li><a class="reference external" href="http://www.jumpnowtek.com/rpi/Using-mcp3008-ADCs-with-Raspberry-Pis.html">MCP3008 Overlay</a></li>
<li><a class="reference external" href="https://github.com/scottellis/mcp3008-poll">C Program to poll overlay</a></li>
</ul>
</div>


<p align="center"><a href="#">on the top</a></p>
    </div>
</div>
<div id="footer-wrapper">
<ul class="footer">
</ul><ul class="footer">
    <li class="footer">&copy;&nbsp;2016&nbsp;Kevin J. Walchko&nbsp;::</li>
    <li class="footer"><a href="../../../..">Planet Express </a>&nbsp;::</li>
    <li class="footer"><a href="https://github.com/getpelican">pelican</a></li>
    <!-- <li class="footer"><a href="http://creativecommons.org/licenses/by-nc/3.0/deed">Content CC BY-NC</a>&nbsp;::</li> -->
    <!-- <li class="footer"><a href="http://fontawesome.io">Font Awesome <i class="fa fa-flag"></i></a></li> -->
    <!-- <li class="footer"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></li> -->
</ul>
<span><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a></span>
</div></body>
</html>